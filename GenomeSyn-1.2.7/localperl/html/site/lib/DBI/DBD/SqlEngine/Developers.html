<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../../../../displayToc.js"></script>
<script language="JavaScript" src="../../../../../tocParas.js"></script>
<script language="JavaScript" src="../../../../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../../scineplex.css">
<title></title>
<link rel="stylesheet" href="../../../../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:support@ActiveState.com" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#CLASSES">CLASSES</a>
    <ul>
      <li><a href="#DBI::DBD::SqlEngine">DBI::DBD::SqlEngine</a></li>
      <li><a href="#DBI::DBD::SqlEngine::dr1">DBI::DBD::SqlEngine::dr</a>
        <ul>
          <li><a href="#Methods-provided-by-:">Methods provided by :</a></li>
        </ul>
      </li>
      <li><a href="#DBI::DBD::SqlEngine::db1">DBI::DBD::SqlEngine::db</a>
        <ul>
          <li><a href="#Methods-provided-by-:1">Methods provided by :</a></li>
          <li><a href="#Attributes-used-by-:">Attributes used by :</a></li>
        </ul>
      </li>
      <li><a href="#DBI::DBD::SqlEngine::st1">DBI::DBD::SqlEngine::st</a></li>
      <li><a href="#DBI::DBD::SqlEngine::TableSource">DBI::DBD::SqlEngine::TableSource</a></li>
      <li><a href="#DBI::DBD::SqlEngine::DataSource">DBI::DBD::SqlEngine::DataSource</a></li>
      <li><a href="#DBI::DBD::SqlEngine::Statement">DBI::DBD::SqlEngine::Statement</a></li>
      <li><a href="#DBI::DBD::SqlEngine::Table">DBI::DBD::SqlEngine::Table</a></li>
    </ul>
  </li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#COPYRIGHT-AND-LICENSE">COPYRIGHT AND LICENSE</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>DBI::DBD::SqlEngine::Developers - Developers documentation for DBI::DBD::SqlEngine</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code><code>    <span class="keyword">package</span> <span class="variable">DBD::myDriver</span><span class="operator">;</span>
    
    <span class="keyword">use</span> <span class="variable">base</span> <span class="string">qw(DBI::DBD::SqlEngine)</span><span class="operator">;</span>
    
    <span class="keyword">sub</span><span class="variable"> driver
    </span><span class="operator">{</span>
        <span class="operator">...</span>
        <span class="keyword">my</span> <span class="variable">$drh</span> <span class="operator">=</span> <span class="variable">$proto</span><span class="operator">-&gt;</span><span class="variable">SUPER::driver</span><span class="operator">(</span><span class="variable">$attr</span><span class="operator">);</span>
        <span class="operator">...</span>
        <span class="keyword">return</span> <span class="variable">$drh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">class</span><span class="operator">}</span><span class="operator">;</span>
    <span class="operator">}</span>
    
    <span class="keyword">sub</span><span class="variable"> CLONE </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    
    <span class="keyword">package</span> <span class="variable">DBD::myDriver::dr</span><span class="operator">;</span>
    
    <span class="variable">@ISA</span> <span class="operator">=</span> <span class="string">qw(DBI::DBD::SqlEngine::dr)</span><span class="operator">;</span>
    
    <span class="keyword">sub</span><span class="variable"> data_sources </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="operator">...</span>
    
    <span class="keyword">package</span> <span class="variable">DBD::myDriver::db</span><span class="operator">;</span>
    
    <span class="variable">@ISA</span> <span class="operator">=</span> <span class="string">qw(DBI::DBD::SqlEngine::db)</span><span class="operator">;</span>
    
    <span class="keyword">sub</span><span class="variable"> init_valid_attributes </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> init_default_attributes </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> set_versions </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> validate_STORE_attr </span><span class="operator">{</span> <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$dbh</span><span class="operator">,</span> <span class="variable">$attrib</span><span class="operator">,</span> <span class="variable">$value</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> validate_FETCH_attr </span><span class="operator">{</span> <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$dbh</span><span class="operator">,</span> <span class="variable">$attrib</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> get_myd_versions </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> get_avail_tables </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    
    <span class="keyword">package</span> <span class="variable">DBD::myDriver::st</span><span class="operator">;</span>
    
    <span class="variable">@ISA</span> <span class="operator">=</span> <span class="string">qw(DBI::DBD::SqlEngine::st)</span><span class="operator">;</span>
    
    <span class="keyword">sub</span><span class="variable"> FETCH </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> STORE </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    
    <span class="keyword">package</span> <span class="variable">DBD::myDriver::Statement</span><span class="operator">;</span>
    
    <span class="variable">@ISA</span> <span class="operator">=</span> <span class="string">qw(DBI::DBD::SqlEngine::Statement)</span><span class="operator">;</span>
    
    <span class="keyword">sub</span><span class="variable"> open_table </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    
    <span class="keyword">package</span> <span class="variable">DBD::myDriver::Table</span><span class="operator">;</span>
    
    <span class="variable">@ISA</span> <span class="operator">=</span> <span class="string">qw(DBI::DBD::SqlEngine::Table)</span><span class="operator">;</span>
    
    <span class="keyword">my</span> <span class="variable">%reset_on_modify</span> <span class="operator">=</span> <span class="operator">(</span>
                            <span class="string">myd_abc</span> <span class="operator">=&gt;</span> <span class="string">"myd_foo"</span><span class="operator">,</span>
                            <span class="string">myd_mno</span> <span class="operator">=&gt;</span> <span class="string">"myd_bar"</span><span class="operator">,</span>
                          <span class="operator">);</span>
    <span class="keyword">__PACKAGE__</span><span class="operator">-&gt;</span><span class="variable">register_reset_on_modify</span><span class="operator">(</span> <span class="operator">\</span><span class="variable">%reset_on_modify</span> <span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">%compat_map</span> <span class="operator">=</span> <span class="operator">(</span>
                       <span class="string">abc</span> <span class="operator">=&gt;</span> <span class="string">'foo_abc'</span><span class="operator">,</span>
                       <span class="string">xyz</span> <span class="operator">=&gt;</span> <span class="string">'foo_xyz'</span><span class="operator">,</span>
                     <span class="operator">);</span>
    <span class="keyword">__PACKAGE__</span><span class="operator">-&gt;</span><span class="variable">register_compat_map</span><span class="operator">(</span> <span class="operator">\</span><span class="variable">%compat_map</span> <span class="operator">);</span>
    
    <span class="keyword">sub</span><span class="variable"> bootstrap_table_meta </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> init_table_meta </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> table_meta_attr_changed </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> open_data </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    
    <span class="keyword">sub</span><span class="variable"> new </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    
    <span class="keyword">sub</span><span class="variable"> fetch_row </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> push_row </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> push_names </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> seek </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> truncate </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="keyword">sub</span><span class="variable"> drop </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    
    <span class="comment"># optimize the SQL engine by add one or more of</span>
    <span class="keyword">sub</span><span class="variable"> update_current_row </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="comment"># or</span>
    <span class="keyword">sub</span><span class="variable"> update_specific_row </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="comment"># or</span>
    <span class="keyword">sub</span><span class="variable"> update_one_row </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="comment"># or</span>
    <span class="keyword">sub</span><span class="variable"> insert_new_row </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="comment"># or</span>
    <span class="keyword">sub</span><span class="variable"> delete_current_row </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    <span class="comment"># or</span>
    <span class="keyword">sub</span><span class="variable"> delete_one_row </span><span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
</code></code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This document describes the interface of DBI::DBD::SqlEngine for DBD developers who write DBI::DBD::SqlEngine based DBI drivers. It supplements <a href="../../../../../lib/DBI/DBD.html">DBI::DBD</a> and <a href="../../../../../lib/DBI/DBD/SqlEngine/HowTo.html">DBI::DBD::SqlEngine::HowTo</a>, which you should read first.</p>

<h1 id="CLASSES">CLASSES</h1>

<p>Each DBI driver must provide a package global <code><code>driver</code></code> method and three DBI related classes:</p>

<dl>

<dt id="DBI::DBD::SqlEngine::dr">DBI::DBD::SqlEngine::dr</dt>
<dd>

<p>Driver package, contains the methods DBI calls indirectly via DBI interface:</p>

<pre><code><code>  <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span> <span class="operator">(</span><span class="string">'DBI:DBM:'</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="operator">{}</span><span class="operator">)</span>
  
  <span class="comment"># invokes</span>
  <span class="keyword">package</span> <span class="variable">DBD::DBM::dr</span><span class="operator">;</span>
  <span class="variable">@DBD::DBM::dr::ISA</span> <span class="operator">=</span> <span class="string">qw(DBI::DBD::SqlEngine::dr)</span><span class="operator">;</span>
  
  <span class="keyword">sub</span><span class="variable"> connect </span><span class="operator">(</span>$$;$$$<span class="operator">)</span>
  <span class="operator">{</span>
      <span class="operator">...</span>
  <span class="operator">}</span>
</code></code></pre>

<p>Similar for <code><code>data_sources ()</code></code> and <code><code>disconnect_all()</code></code>.</p>

<p>Pure Perl DBI drivers derived from DBI::DBD::SqlEngine usually don&#39;t need to override any of the methods provided through the DBD::XXX::dr package. However if you need additional initialization not fitting in <code><code>init_valid_attributes()</code></code> and <code><code>init_default_attributes()</code></code> of you&#39;re ::db class, the connect method might be the final place to be modified.</p>

</dd>
<dt id="DBI::DBD::SqlEngine::db">DBI::DBD::SqlEngine::db</dt>
<dd>

<p>Contains the methods which are called through DBI database handles (<code><code>$dbh</code></code>). e.g.,</p>

<pre><code><code>  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span> <span class="operator">(</span><span class="string">"select * from foo"</span><span class="operator">);</span>
  <span class="comment"># returns the f_encoding setting for table foo</span>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">csv_get_meta</span> <span class="operator">(</span><span class="string">"foo"</span><span class="operator">,</span> <span class="string">"f_encoding"</span><span class="operator">);</span>
</code></code></pre>

<p>DBI::DBD::SqlEngine provides the typical methods required here. Developers who write DBI drivers based on DBI::DBD::SqlEngine need to override the methods <code><code>set_versions</code></code> and <code><code>init_valid_attributes</code></code>.</p>

</dd>
<dt id="DBI::DBD::SqlEngine::TieMeta-">DBI::DBD::SqlEngine::TieMeta;</dt>
<dd>

<p>Provides the tie-magic for <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="variable">$drv_pfx</span> <span class="operator">.</span> <span class="string">"_meta"</span><span class="operator">}</span>
</code></code>. Routes <code><code>STORE</code></code> through <code><code>$drv-&gt;set_sql_engine_meta()</code></code> and <code><code>FETCH</code></code> through <code><code>$drv-&gt;get_sql_engine_meta()</code></code>. <code><code>DELETE</code></code> is not supported, you have to execute a <code><code>DROP TABLE</code></code> statement, where applicable.</p>

</dd>
<dt id="DBI::DBD::SqlEngine::TieTables-">DBI::DBD::SqlEngine::TieTables;</dt>
<dd>

<p>Provides the tie-magic for tables in <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="variable">$drv_pfx</span> <span class="operator">.</span> <span class="string">"_meta"</span><span class="operator">}</span>
</code></code>. Routes <code><code>STORE</code></code> though <code><code>$tblClass-&gt;set_table_meta_attr()</code></code> and <code><code>FETCH</code></code> though <code><code>$tblClass-&gt;get_table_meta_attr()</code></code>. <code><code>DELETE</code></code> removes an attribute from the <i>meta object</i> retrieved by <code><code>$tblClass-&gt;get_table_meta()</code></code>.</p>

</dd>
<dt id="DBI::DBD::SqlEngine::st">DBI::DBD::SqlEngine::st</dt>
<dd>

<p>Contains the methods to deal with prepared statement handles. e.g.,</p>

<pre><code><code>  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span> <span class="operator">()</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</code></code></pre>

</dd>
<dt id="DBI::DBD::SqlEngine::TableSource-">DBI::DBD::SqlEngine::TableSource;</dt>
<dd>

<p>Base class for 3rd party table sources:</p>

<pre><code><code>  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_table_source</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">"DBD::Foo::TableSource"</span><span class="operator">;</span>
</code></code></pre>

</dd>
<dt id="DBI::DBD::SqlEngine::DataSource-">DBI::DBD::SqlEngine::DataSource;</dt>
<dd>

<p>Base class for 3rd party data sources:</p>

<pre><code><code>  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_data_source</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">"DBD::Foo::DataSource"</span><span class="operator">;</span>
</code></code></pre>

</dd>
<dt id="DBI::DBD::SqlEngine::Statement-">DBI::DBD::SqlEngine::Statement;</dt>
<dd>

<p>Base class for derived drivers statement engine. Implements <code><code>open_table</code></code>.</p>

</dd>
<dt id="DBI::DBD::SqlEngine::Table-">DBI::DBD::SqlEngine::Table;</dt>
<dd>

<p>Contains tailoring between SQL engine&#39;s requirements and <code><code>DBI::DBD::SqlEngine</code></code> magic for finding the right tables and storage. Builds bridges between <code><code>sql_meta</code></code> handling of <code><code>DBI::DBD::SqlEngine::db</code></code>, table initialization for SQL engines and <i>meta object</i>&#39;s attribute management for derived drivers.</p>

</dd>
</dl>

<h2 id="DBI::DBD::SqlEngine">DBI::DBD::SqlEngine</h2>

<p>This is the main package containing the routines to initialize DBI::DBD::SqlEngine based DBI drivers. Primarily the <code><code>DBI::DBD::SqlEngine::driver</code></code> method is invoked, either directly from DBI when the driver is initialized or from the derived class.</p>

<pre><code><code>  <span class="keyword">package</span> <span class="variable">DBD::DBM</span><span class="operator">;</span>
  
  <span class="keyword">use</span> <span class="variable">base</span> <span class="string">qw( DBI::DBD::SqlEngine )</span><span class="operator">;</span>
  
  <span class="keyword">sub</span><span class="variable"> driver
  </span><span class="operator">{</span>
      <span class="keyword">my</span> <span class="operator">(</span> <span class="variable">$class</span><span class="operator">,</span> <span class="variable">$attr</span> <span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
      <span class="operator">...</span>
      <span class="keyword">my</span> <span class="variable">$drh</span> <span class="operator">=</span> <span class="variable">$class</span><span class="operator">-&gt;</span><span class="variable">SUPER::driver</span><span class="operator">(</span> <span class="variable">$attr</span> <span class="operator">);</span>
      <span class="operator">...</span>
      <span class="keyword">return</span> <span class="variable">$drh</span><span class="operator">;</span>
  <span class="operator">}</span>
</code></code></pre>

<p>It is not necessary to implement your own driver method as long as additional initialization (e.g. installing more private driver methods) is not required. You do not need to call <code><code>setup_driver</code></code> as DBI::DBD::SqlEngine takes care of it.</p>

<h2 id="DBI::DBD::SqlEngine::dr1">DBI::DBD::SqlEngine::dr</h2>

<p>The driver package contains the methods DBI calls indirectly via the DBI interface (see <a href="../../../../../lib/DBI.html#DBI-Class-Methods">&quot;DBI Class Methods&quot; in DBI</a>).</p>

<p>DBI::DBD::SqlEngine based DBI drivers usually do not need to implement anything here, it is enough to do the basic initialization:</p>

<pre><code><code>  <span class="keyword">package</span> <span class="variable">DBD</span><span class="operator">:</span><span class="variable">XXX::dr</span><span class="operator">;</span>
  
  <span class="variable">@DBD::XXX::dr::ISA</span> <span class="operator">=</span> <span class="string">qw (DBI::DBD::SqlEngine::dr)</span><span class="operator">;</span>
  <span class="variable">$DBD::XXX::dr::imp_data_size</span>     <span class="operator">=</span> <span class="number">0</span><span class="operator">;</span>
  <span class="variable">$DBD::XXX::dr::data_sources_attr</span> <span class="operator">=</span> <span class="keyword">undef</span><span class="operator">;</span>
  <span class="variable">$DBD::XXX::ATTRIBUTION</span> <span class="operator">=</span> <span class="string">"DBD::XXX </span><span class="variable">$DBD</span><span class="string">::XXX::VERSION by Hans Mustermann"</span><span class="operator">;</span>
</code></code></pre>

<h3 id="Methods-provided-by-:">Methods provided by <code><code>DBI::DBD::SqlEngine::dr</code></code>:</h3>

<dl>

<dt id="connect">connect</dt>
<dd>

<p>Supervises the driver bootstrap when calling</p>

<pre><code><code>  <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span> <span class="string">"dbi:Foo"</span><span class="operator">,</span> <span class="operator">,</span> <span class="operator">,</span> <span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span> <span class="operator">);</span>
</code></code></pre>

<p>First it instantiates a new driver using <code><code>DBI::_new_dbh</code></code>. After that, initial bootstrap of the newly instantiated driver is done by</p>

<pre><code><code>  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">func</span><span class="operator">(</span> <span class="number">0</span><span class="operator">,</span> <span class="string">"init_default_attributes"</span> <span class="operator">);</span>
</code></code></pre>

<p>The first argument (<code><code>0</code></code>) signals that this is the very first call to <code><code>init_default_attributes</code></code>. Modern drivers understand that and do early stage setup here after calling</p>

<pre><code><code>  <span class="keyword">package</span> <span class="variable">DBD::Foo::db</span><span class="operator">;</span>
  <span class="keyword">our</span> <span class="variable">@DBD::Foo::db::ISA</span> <span class="operator">=</span> <span class="string">qw(DBI::DBD::SqlEngine::db)</span><span class="operator">;</span>
  
  <span class="keyword">sub</span><span class="variable"> init_default_attributes
  </span><span class="operator">{</span>
    <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$dbh</span><span class="operator">,</span> <span class="variable">$phase</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
    <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">SUPER::init_default_attributes</span><span class="operator">(</span><span class="variable">$phase</span><span class="operator">);</span>
    <span class="operator">...;</span> <span class="comment"># own setup code, maybe separated by phases</span>
  <span class="operator">}</span>
</code></code></pre>

<p>When the <code><code>$phase</code></code> argument is passed down until <code><code>DBI::DBD::SqlEngine::db::init_default_attributes</code></code>, <code><code>connect()</code></code> recognizes a <i>modern</i> driver and initializes the attributes from <i>DSN</i> and <i>$attr</i> arguments passed via <code><code>DBI-&gt;connect( $dsn, $user, $pass, \%attr )</code></code>.</p>

<p>At the end of the attribute initialization after <i>phase 0</i>, <code><code>connect()</code></code> invoked <code><code>init_default_attributes</code></code> again for <i>phase 1</i>:</p>

<pre><code><code>  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">func</span><span class="operator">(</span> <span class="number">1</span><span class="operator">,</span> <span class="string">"init_default_attributes"</span> <span class="operator">);</span>
</code></code></pre>

</dd>
<dt id="data_sources">data_sources</dt>
<dd>

<p>Returns a list of <i>DSN</i>&#39;s using the <code><code>data_sources</code></code> method of the class specified in <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_table_source</span><span class="operator">}</span>
</code></code> or via <code><code>\%attr</code></code>:</p>

<pre><code><code>  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">(</span><span class="variable">$driver</span><span class="operator">);</span>
  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">(</span><span class="variable">$driver</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
</code></code></pre>

</dd>
<dt id="disconnect_all">disconnect_all</dt>
<dd>

<p><code><code>DBI::DBD::SqlEngine</code></code> doesn&#39;t have an overall driver cache, so nothing happens here at all.</p>

</dd>
</dl>

<h2 id="DBI::DBD::SqlEngine::db1">DBI::DBD::SqlEngine::db</h2>

<p>This package defines the database methods, which are called via the DBI database handle <code><code>$dbh</code></code>.</p>

<h3 id="Methods-provided-by-:1">Methods provided by <code><code>DBI::DBD::SqlEngine::db</code></code>:</h3>

<dl>

<dt id="ping">ping</dt>
<dd>

<p>Simply returns the content of the <code><code>Active</code></code> attribute. Override when your driver needs more complicated actions here.</p>

</dd>
<dt id="prepare">prepare</dt>
<dd>

<p>Prepares a new SQL statement to execute. Returns a statement handle, <code><code>$sth</code></code> - instance of the DBD:XXX::st. It is neither required nor recommended to override this method.</p>

</dd>
<dt id="validate_FETCH_attr">validate_FETCH_attr</dt>
<dd>

<p>Called by <code><code>FETCH</code></code> to allow inherited drivers do their own attribute name validation. Calling convention is similar to <code><code>FETCH</code></code> and the return value is the approved attribute name.</p>

<pre><code><code>    <span class="keyword">return</span> <span class="variable">$validated_attribute_name</span><span class="operator">;</span>
</code></code></pre>

<p>In case of validation fails (e.g. accessing private attribute or similar), <code><code>validate_FETCH_attr</code></code> is permitted to throw an exception.</p>

</dd>
<dt id="FETCH">FETCH</dt>
<dd>

<p>Fetches an attribute of a DBI database object. Private handle attributes must have a prefix (this is mandatory). If a requested attribute is detected as a private attribute without a valid prefix, the driver prefix (written as <code><code>$drv_prefix</code></code>) is added.</p>

<p>The driver prefix is extracted from the attribute name and verified against <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span> <span class="variable">$drv_prefix</span> <span class="operator">.</span> <span class="string">"valid_attrs"</span> <span class="operator">}</span>
</code></code> (when it exists). If the requested attribute value is not listed as a valid attribute, this method croaks. If the attribute is valid and readonly (listed in <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span> <span class="variable">$drv_prefix</span> <span class="operator">.</span> <span class="string">"readonly_attrs"</span> <span class="operator">}</span>
</code></code> when it exists), a real copy of the attribute value is returned. So it&#39;s not possible to modify <code><code>f_valid_attrs</code></code> from outside of DBI::DBD::SqlEngine::db or a derived class.</p>

</dd>
<dt id="validate_STORE_attr">validate_STORE_attr</dt>
<dd>

<p>Called by <code><code>STORE</code></code> to allow inherited drivers do their own attribute name validation. Calling convention is similar to <code><code>STORE</code></code> and the return value is the approved attribute name followed by the approved new value.</p>

<pre><code><code>    <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$validated_attribute_name</span><span class="operator">,</span> <span class="variable">$validated_attribute_value</span><span class="operator">);</span>
</code></code></pre>

<p>In case of validation fails (e.g. accessing private attribute or similar), <code><code>validate_STORE_attr</code></code> is permitted to throw an exception (<code><code>DBI::DBD::SqlEngine::db::validate_STORE_attr</code></code> throws an exception when someone tries to assign value other than <code><code>SQL_IC_UPPER .. SQL_IC_MIXED</code></code> to <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_identifier_case</span><span class="operator">}</span>
</code></code> or <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_quoted_identifier_case</span><span class="operator">}</span>
</code></code>).</p>

</dd>
<dt id="STORE">STORE</dt>
<dd>

<p>Stores a database private attribute. Private handle attributes must have a prefix (this is mandatory). If a requested attribute is detected as a private attribute without a valid prefix, the driver prefix (written as <code><code>$drv_prefix</code></code>) is added. If the database handle has an attribute <code><code><span class="variable">$</span><span class="operator">{</span><span class="string">drv_prefix</span><span class="operator">}</span><span class="variable">_valid_attrs</span>
</code></code> - for attribute names which are not listed in that hash, this method croaks. If the database handle has an attribute <code><code><span class="variable">$</span><span class="operator">{</span><span class="string">drv_prefix</span><span class="operator">}</span><span class="variable">_readonly_attrs</span>
</code></code>, only attributes which are not listed there can be stored (once they are initialized). Trying to overwrite such an immutable attribute forces this method to croak.</p>

<p>An example of a valid attributes list can be found in <code><code>DBI::DBD::SqlEngine::db::init_valid_attributes</code></code>.</p>

</dd>
<dt id="set_versions">set_versions</dt>
<dd>

<p>This method sets the attributes <code><code>f_version</code></code>, <code><code>sql_nano_version</code></code>, <code><code>sql_statement_version</code></code> and (if not prohibited by a restrictive <code><code><span class="variable">$</span><span class="operator">{</span><span class="string">prefix</span><span class="operator">}</span><span class="variable">_valid_attrs</span>
</code></code>) <code><code><span class="variable">$</span><span class="operator">{</span><span class="string">prefix</span><span class="operator">}</span><span class="variable">_version</span>
</code></code>.</p>

<p>This method is called at the end of the <code><code>connect ()</code></code> phase.</p>

<p>When overriding this method, do not forget to invoke the superior one.</p>

</dd>
<dt id="init_valid_attributes">init_valid_attributes</dt>
<dd>

<p>This method is called after the database handle is instantiated as the first attribute initialization.</p>

<p><code><code>DBI::DBD::SqlEngine::db::init_valid_attributes</code></code> initializes the attributes <code><code>sql_valid_attrs</code></code> and <code><code>sql_readonly_attrs</code></code>.</p>

<p>When overriding this method, do not forget to invoke the superior one, preferably before doing anything else.</p>

</dd>
<dt id="init_default_attributes">init_default_attributes</dt>
<dd>

<p>This method is called after the database handle is instantiated to initialize the default attributes. It expects one argument: <code><code>$phase</code></code>. If <code><code>$phase</code></code> is not given, <code><code>connect</code></code> of <code><code>DBI::DBD::SqlEngine::dr</code></code> expects this is an old-fashioned driver which isn&#39;t capable of multi-phased initialization.</p>

<p><code><code>DBI::DBD::SqlEngine::db::init_default_attributes</code></code> initializes the attributes <code><code>sql_identifier_case</code></code>, <code><code>sql_quoted_identifier_case</code></code>, <code><code>sql_handler</code></code>, <code><code>sql_init_order</code></code>, <code><code>sql_meta</code></code>, <code><code>sql_engine_version</code></code>, <code><code>sql_nano_version</code></code> and <code><code>sql_statement_version</code></code> when <a href="../../../../../lib/SQL/Statement.html">SQL::Statement</a> is available.</p>

<p>It sets <code><code>sql_init_order</code></code> to the given <code><code>$phase</code></code>.</p>

<p>When the derived implementor class provides the attribute to validate attributes (e.g. <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">dbm_valid_attrs</span><span class="operator">}</span> <span class="operator">=</span> <span class="operator">{</span><span class="operator">...</span><span class="operator">}</span><span class="operator">;</span>
</code></code>) or the attribute containing the immutable attributes (e.g. <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">dbm_readonly_attrs</span><span class="operator">}</span> <span class="operator">=</span> <span class="operator">{</span><span class="operator">...</span><span class="operator">}</span><span class="operator">;</span>
</code></code>), the attributes <code><code>drv_valid_attrs</code></code>, <code><code>drv_readonly_attrs</code></code> and <code><code>drv_version</code></code> are added (when available) to the list of valid and immutable attributes (where <code><code>drv_</code></code> is interpreted as the driver prefix).</p>

</dd>
<dt id="get_versions">get_versions</dt>
<dd>

<p>This method is called by the code injected into the instantiated driver to provide the user callable driver method <code><code><span class="variable">$</span><span class="operator">{</span><span class="string">prefix</span><span class="operator">}</span><span class="variable">versions</span>
</code></code> (e.g. <code><code>dbm_versions</code></code>, <code><code>csv_versions</code></code>, ...).</p>

<p>The DBI::DBD::SqlEngine implementation returns all version information known by DBI::DBD::SqlEngine (e.g. DBI version, Perl version, DBI::DBD::SqlEngine version and the SQL handler version).</p>

<p><code><code>get_versions</code></code> takes the <code><code>$dbh</code></code> as the first argument and optionally a second argument containing a table name. The second argument is not evaluated in <code><code>DBI::DBD::SqlEngine::db::get_versions</code></code> itself - but might be in the future.</p>

<p>If the derived implementor class provides a method named <code><code><span class="variable">get_</span><span class="variable">$</span><span class="operator">{</span><span class="string">drv_prefix</span><span class="operator">}</span><span class="variable">versions</span>
</code></code>, this is invoked and the return value of it is associated to the derived driver name:</p>

<pre><code><code>    <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">my</span> <span class="variable">$dgv</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">ImplementorClass</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="variable">can</span> <span class="operator">(</span><span class="string">"get_"</span> <span class="operator">.</span> <span class="variable">$drv_prefix</span> <span class="operator">.</span> <span class="string">"versions"</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="operator">(</span><span class="keyword">my</span> <span class="variable">$derived_driver</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">ImplementorClass</span><span class="operator">}</span><span class="operator">)</span> <span class="operator">=~</span> <span class="regex">s/::db$//</span><span class="operator">;</span>
        <span class="variable">$versions</span><span class="operator">{</span><span class="variable">$derived_driver</span><span class="operator">}</span> <span class="operator">=</span> <span class="operator">&amp;</span><span class="variable">$dgv</span> <span class="operator">(</span><span class="variable">$dbh</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">);</span>
    <span class="operator">}</span>
</code></code></pre>

<p>Override it to add more version information about your module, (e.g. some kind of parser version in case of DBD::CSV, ...), if one line is not enough room to provide all relevant information.</p>

</dd>
<dt id="sql_parser_object">sql_parser_object</dt>
<dd>

<p>Returns a <a href="../../../../../lib/SQL/Parser.html">SQL::Parser</a> instance, when <code><code>sql_handler</code></code> is set to &quot;SQL::Statement&quot;. The parser instance is stored in <code><code>sql_parser_object</code></code>.</p>

<p>It is not recommended to override this method.</p>

</dd>
<dt id="disconnect">disconnect</dt>
<dd>

<p>Disconnects from a database. All local table information is discarded and the <code><code>Active</code></code> attribute is set to 0.</p>

</dd>
<dt id="type_info_all">type_info_all</dt>
<dd>

<p>Returns information about all the types supported by DBI::DBD::SqlEngine.</p>

</dd>
<dt id="table_info">table_info</dt>
<dd>

<p>Returns a statement handle which is prepared to deliver information about all known tables.</p>

</dd>
<dt id="list_tables">list_tables</dt>
<dd>

<p>Returns a list of all known table names.</p>

</dd>
<dt id="quote">quote</dt>
<dd>

<p>Quotes a string for use in SQL statements.</p>

</dd>
<dt id="commit">commit</dt>
<dd>

<p>Warns about a useless call (if warnings enabled) and returns. DBI::DBD::SqlEngine is typically a driver which commits every action instantly when executed.</p>

</dd>
<dt id="rollback">rollback</dt>
<dd>

<p>Warns about a useless call (if warnings enabled) and returns. DBI::DBD::SqlEngine is typically a driver which commits every action instantly when executed.</p>

</dd>
</dl>

<h3 id="Attributes-used-by-:">Attributes used by <code><code>DBI::DBD::SqlEngine::db</code></code>:</h3>

<p>This section describes attributes which are important to developers of DBI Database Drivers derived from <code><code>DBI::DBD::SqlEngine</code></code>.</p>

<dl>

<dt id="sql_init_order">sql_init_order</dt>
<dd>

<p>This attribute contains a hash with priorities as key and an array containing the <code><code>$dbh</code></code> attributes to be initialized during before/after other attributes.</p>

<p><code><code>DBI::DBD::SqlEngine</code></code> initializes following attributes:</p>

<pre><code><code>  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_init_order</span><span class="operator">}</span> <span class="operator">=</span> <span class="operator">{</span>
       <span class="number">0</span> <span class="operator">=&gt;</span> <span class="operator">[</span><span class="string">qw( Profile RaiseError PrintError AutoCommit )</span><span class="operator">]</span><span class="operator">,</span>
      <span class="number">90</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="string">"sql_meta"</span><span class="operator">,</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="variable">$drv_pfx_meta</span><span class="operator">}</span> <span class="operator">?</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="variable">$drv_pfx_meta</span><span class="operator">}</span> <span class="operator">:</span> <span class="operator">()</span> <span class="operator">]</span>
  <span class="operator">}</span>
</code></code></pre>

<p>The default priority of not listed attribute keys is <code><code>50</code></code>. It is well known that a lot of attributes needed to be set before some table settings are initialized. For example, for <a href="../../../../../lib/DBD/DBM.html">DBD::DBM</a>, when using</p>

<pre><code><code>  <span class="keyword">my</span> <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span> <span class="string">"dbi:DBM:"</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="operator">{</span>
      <span class="string">f_dir</span> <span class="operator">=&gt;</span> <span class="string">"/path/to/dbm/databases"</span><span class="operator">,</span>
      <span class="string">dbm_type</span> <span class="operator">=&gt;</span> <span class="string">"BerkeleyDB"</span><span class="operator">,</span>
      <span class="string">dbm_mldbm</span> <span class="operator">=&gt;</span> <span class="string">"JSON"</span><span class="operator">,</span> <span class="comment"># use MLDBM::Serializer::JSON</span>
      <span class="string">dbm_tables</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
          <span class="string">quick</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
              <span class="string">dbm_type</span> <span class="operator">=&gt;</span> <span class="string">"GDBM_File"</span><span class="operator">,</span>
              <span class="string">dbm_MLDBM</span> <span class="operator">=&gt;</span> <span class="string">"FreezeThaw"</span>
          <span class="operator">}</span>
      <span class="operator">}</span>
  <span class="operator">}</span><span class="operator">);</span>
</code></code></pre>

<p>This defines a known table <code><code>quick</code></code> which uses the <a href="../../../../../lib/GDBM_File.html">GDBM_File</a> backend and <a>FreezeThaw</a> as serializer instead of the overall default <a>BerkeleyDB</a> and <a href="../../../../../lib/JSON.html">JSON</a>. <b>But</b> all files containing the table data have to be searched in <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">f_dir</span><span class="operator">}</span>
</code></code>, which requires <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">f_dir</span><span class="operator">}</span>
</code></code> must be initialized before <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_meta</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">quick</span><span class="operator">}</span>
</code></code> is initialized by <code><code>bootstrap_table_meta</code></code> method of <a href="#DBI::DBD::SqlEngine::Table">&quot;DBI::DBD::SqlEngine::Table&quot;</a> to get <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_meta</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">quick</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">f_dir</span><span class="operator">}</span>
</code></code> being initialized properly.</p>

</dd>
<dt id="sql_init_phase">sql_init_phase</dt>
<dd>

<p>This attribute is only set during the initialization steps of the DBI Database Driver. It contains the value of the currently run initialization phase. Currently supported phases are <i>phase 0</i> and <i>phase 1</i>. This attribute is set in <code><code>init_default_attributes</code></code> and removed in <code><code>init_done</code></code>.</p>

</dd>
<dt id="sql_engine_in_gofer">sql_engine_in_gofer</dt>
<dd>

<p>This value has a true value in case of this driver is operated via <a href="../../../../../lib/DBD/Gofer.html">DBD::Gofer</a>. The impact of being operated via Gofer is a read-only driver (not read-only databases!), so you cannot modify any attributes later - neither any table settings. <b>But</b> you won&#39;t get an error in cases you modify table attributes, so please carefully watch <code><code>sql_engine_in_gofer</code></code>.</p>

</dd>
<dt id="sql_table_source">sql_table_source</dt>
<dd>

<p>Names a class which is responsible for delivering <i>data sources</i> and <i>available tables</i> (Database Driver related). <i>data sources</i> here refers to <a href="../../../../../lib/DBI.html#data_sources">&quot;data_sources&quot; in DBI</a>, not <code><code>sql_data_source</code></code>.</p>

<p>See <a href="#DBI::DBD::SqlEngine::TableSource">&quot;DBI::DBD::SqlEngine::TableSource&quot;</a> for details.</p>

</dd>
<dt id="sql_data_source">sql_data_source</dt>
<dd>

<p>Name a class which is responsible for handling table resources open and completing table names requested via SQL statements.</p>

<p>See <a href="#DBI::DBD::SqlEngine::DataSource">&quot;DBI::DBD::SqlEngine::DataSource&quot;</a> for details.</p>

</dd>
<dt id="sql_dialect">sql_dialect</dt>
<dd>

<p>Controls the dialect understood by SQL::Parser. Possible values (delivery state of SQL::Statement):</p>

<pre><code><code>  * ANSI
  * CSV
  * AnyData</code></code></pre>

<p>Defaults to &quot;CSV&quot;. Because an SQL::Parser is instantiated only once and SQL::Parser doesn&#39;t allow to modify the dialect once instantiated, it&#39;s strongly recommended to set this flag before any statement is executed (best place is connect attribute hash).</p>

</dd>
</dl>

<h2 id="DBI::DBD::SqlEngine::st1">DBI::DBD::SqlEngine::st</h2>

<p>Contains the methods to deal with prepared statement handles:</p>

<dl>

<dt id="bind_param">bind_param</dt>
<dd>

<p>Common routine to bind placeholders to a statement for execution. It is dangerous to override this method without detailed knowledge about the DBI::DBD::SqlEngine internal storage structure.</p>

</dd>
<dt id="execute">execute</dt>
<dd>

<p>Executes a previously prepared statement (with placeholders, if any).</p>

</dd>
<dt id="finish">finish</dt>
<dd>

<p>Finishes a statement handle, discards all buffered results. The prepared statement is not discarded so the statement can be executed again.</p>

</dd>
<dt id="fetch">fetch</dt>
<dd>

<p>Fetches the next row from the result-set. This method may be rewritten in a later version and if it&#39;s overridden in a derived class, the derived implementation should not rely on the storage details.</p>

</dd>
<dt id="fetchrow_arrayref">fetchrow_arrayref</dt>
<dd>

<p>Alias for <code><code>fetch</code></code>.</p>

</dd>
<dt id="FETCH1">FETCH</dt>
<dd>

<p>Fetches statement handle attributes. Supported attributes (for full overview see <a href="../../../../../lib/DBI.html#Statement-Handle-Attributes">&quot;Statement Handle Attributes&quot; in DBI</a>) are <code><code>NAME</code></code>, <code><code>TYPE</code></code>, <code><code>PRECISION</code></code> and <code><code>NULLABLE</code></code>. Each column is returned as <code><code>NULLABLE</code></code> which might be wrong depending on the derived backend storage. If the statement handle has private attributes, they can be fetched using this method, too. <b>Note</b> that statement attributes are not associated with any table used in this statement.</p>

<p>This method usually requires extending in a derived implementation. See <a href="../../../../../lib/DBD/CSV.html">DBD::CSV</a> or <a href="../../../../../lib/DBD/DBM.html">DBD::DBM</a> for some example.</p>

</dd>
<dt id="STORE1">STORE</dt>
<dd>

<p>Allows storing of statement private attributes. No special handling is currently implemented here.</p>

</dd>
<dt id="rows">rows</dt>
<dd>

<p>Returns the number of rows affected by the last execute. This method might return <code><code>undef</code></code>.</p>

</dd>
</dl>

<h2 id="DBI::DBD::SqlEngine::TableSource">DBI::DBD::SqlEngine::TableSource</h2>

<p>Provides data sources and table information on database driver and database handle level.</p>

<pre><code><code>  <span class="keyword">package</span> <span class="variable">DBI::DBD::SqlEngine::TableSource</span><span class="operator">;</span>
  
  <span class="keyword">sub</span><span class="variable"> data_sources </span><span class="operator">(</span>$;$<span class="operator">)</span>
  <span class="operator">{</span>
    <span class="keyword">my</span> <span class="operator">(</span> <span class="variable">$class</span><span class="operator">,</span> <span class="variable">$drh</span><span class="operator">,</span> <span class="variable">$attrs</span> <span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
    <span class="operator">...</span>
  <span class="operator">}</span>
  
  <span class="keyword">sub</span><span class="variable"> avail_tables
  </span><span class="operator">{</span>
    <span class="keyword">my</span> <span class="operator">(</span> <span class="variable">$class</span><span class="operator">,</span> <span class="variable">$drh</span> <span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
    <span class="operator">...</span>
  <span class="operator">}</span>
</code></code></pre>

<p>The <code><code>data_sources</code></code> method is called when the user invokes any of the following:</p>

<pre><code><code>  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">(</span><span class="variable">$driver</span><span class="operator">);</span>
  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">(</span><span class="variable">$driver</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
  
  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">();</span>
  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">(\</span><span class="variable">%attr</span><span class="operator">);</span>
</code></code></pre>

<p>The <code><code>avail_tables</code></code> method is called when the user invokes any of the following:</p>

<pre><code><code>  <span class="variable">@names</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">tables</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$type</span> <span class="operator">);</span>
  
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">table_info</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$type</span> <span class="operator">);</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">table_info</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$type</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span> <span class="operator">);</span>
  
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">func</span><span class="operator">(</span> <span class="string">"list_tables"</span> <span class="operator">);</span>
</code></code></pre>

<p>Every time where an <code><code>\%attr</code></code> argument can be specified, this <code><code>\%attr</code></code> object&#39;s <code><code>sql_table_source</code></code> attribute is preferred over the <code><code>$dbh</code></code> attribute or the driver default.</p>

<h2 id="DBI::DBD::SqlEngine::DataSource">DBI::DBD::SqlEngine::DataSource</h2>

<p>Provides base functionality for dealing with tables. It is primarily designed for allowing transparent access to files on disk or already opened (file-)streams (e.g. for DBD::CSV).</p>

<p>Derived classes shall be restricted to similar functionality, too (e.g. opening streams from an archive, transparently compress/uncompress log files before parsing them,</p>

<pre><code><code>  <span class="keyword">package</span> <span class="variable">DBI::DBD::SqlEngine::DataSource</span><span class="operator">;</span>
  
  <span class="keyword">sub</span><span class="variable"> complete_table_name </span><span class="operator">(</span>$$;$<span class="operator">)</span>
  <span class="operator">{</span>
    <span class="keyword">my</span> <span class="operator">(</span> <span class="variable">$self</span><span class="operator">,</span> <span class="variable">$meta</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$respect_case</span> <span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
    <span class="operator">...</span>
  <span class="operator">}</span>
</code></code></pre>

<p>The method <code><code>complete_table_name</code></code> is called when first setting up the <i>meta information</i> for a table:</p>

<pre><code><code>  &quot;SELECT user.id, user.name, user.shell FROM user WHERE ...&quot;</code></code></pre>

<p>results in opening the table <code><code>user</code></code>. First step of the table open process is completing the name. Let&#39;s imagine you&#39;re having a <a href="../../../../../lib/DBD/CSV.html">DBD::CSV</a> handle with following settings:</p>

<pre><code><code>  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_identifier_case</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">SQL_IC_LOWER</span><span class="operator">;</span>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">f_ext</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">'.lst'</span><span class="operator">;</span>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">f_dir</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">'/data/web/adrmgr'</span><span class="operator">;</span>
</code></code></pre>

<p>Those settings will result in looking for files matching <code><code>[Uu][Ss][Ee][Rr](\.lst)?$</code></code> in <code><code>/data/web/adrmgr/</code></code>. The scanning of the directory <code><code>/data/web/adrmgr/</code></code> and the pattern match check will be done in <code><code>DBD::File::DataSource::File</code></code> by the <code><code>complete_table_name</code></code> method.</p>

<p>If you intend to provide other sources of data streams than files, in addition to provide an appropriate <code><code>complete_table_name</code></code> method, a method to open the resource is required:</p>

<pre><code><code>  <span class="keyword">package</span> <span class="variable">DBI::DBD::SqlEngine::DataSource</span><span class="operator">;</span>
  
  <span class="keyword">sub</span><span class="variable"> open_data </span><span class="operator">(</span>$<span class="operator">)</span>
  <span class="operator">{</span>
    <span class="keyword">my</span> <span class="operator">(</span> <span class="variable">$self</span><span class="operator">,</span> <span class="variable">$meta</span><span class="operator">,</span> <span class="variable">$attrs</span><span class="operator">,</span> <span class="variable">$flags</span> <span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
    <span class="operator">...</span>
  <span class="operator">}</span>
</code></code></pre>

<p>After the method <code><code>open_data</code></code> has been run successfully, the table&#39;s meta information are in a state which allows the table&#39;s data accessor methods will be able to fetch/store row information. Implementation details heavily depends on the table implementation, whereby the most famous is surely <a href="../../../../../lib/DBD/File.html#DBD::File::Table">DBD::File::Table</a>.</p>

<h2 id="DBI::DBD::SqlEngine::Statement">DBI::DBD::SqlEngine::Statement</h2>

<p>Derives from DBI::SQL::Nano::Statement for unified naming when deriving new drivers. No additional feature is provided from here.</p>

<h2 id="DBI::DBD::SqlEngine::Table">DBI::DBD::SqlEngine::Table</h2>

<p>Derives from DBI::SQL::Nano::Table for unified naming when deriving new drivers.</p>

<p>You should consult the documentation of <code><code>SQL::Eval::Table</code></code> (see <a href="../../../../../lib/SQL/Eval.html">SQL::Eval</a>) to get more information about the abstract methods of the table&#39;s base class you have to override and a description of the table meta information expected by the SQL engines.</p>

<dl>

<dt id="bootstrap_table_meta">bootstrap_table_meta</dt>
<dd>

<p>Initializes a table meta structure. Can be safely overridden in a derived class, as long as the <code><code>SUPER</code></code> method is called at the end of the overridden method.</p>

<p>It copies the following attributes from the database into the table meta data <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">ReadOnly</span><span class="operator">}</span>
</code></code> into <code><code><span class="variable">$meta</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">readonly</span><span class="operator">}</span>
</code></code>, <code><code>sql_identifier_case</code></code> and <code><code>sql_data_source</code></code> and makes them sticky to the table.</p>

<p>This method should be called before you attempt to map between file name and table name to ensure the correct directory, extension etc. are used.</p>

</dd>
<dt id="init_table_meta">init_table_meta</dt>
<dd>

<p>Initializes more attributes of the table meta data - usually more expensive ones (e.g. those which require class instantiations) - when the file name and the table name could mapped.</p>

</dd>
<dt id="get_table_meta">get_table_meta</dt>
<dd>

<p>Returns the table meta data. If there are none for the required table, a new one is initialized. When after bootstrapping a new <i>table_meta</i> and <a href="#DBI::DBD::SqlEngine::DataSource">completing the table name</a> a mapping can be established between an existing <i>table_meta</i> and the new bootstrapped one, the already existing is used and a mapping shortcut between the recent used table name and the already known table name is hold in <code><code><span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_meta_map</span><span class="operator">}</span>
</code></code>. When it fails, nothing is returned. On success, the name of the table and the meta data structure is returned.</p>

</dd>
<dt id="get_table_meta_attr">get_table_meta_attr</dt>
<dd>

<p>Returns a single attribute from the table meta data. If the attribute name appears in <code><code>%compat_map</code></code>, the attribute name is updated from there.</p>

</dd>
<dt id="set_table_meta_attr">set_table_meta_attr</dt>
<dd>

<p>Sets a single attribute in the table meta data. If the attribute name appears in <code><code>%compat_map</code></code>, the attribute name is updated from there.</p>

</dd>
<dt id="table_meta_attr_changed">table_meta_attr_changed</dt>
<dd>

<p>Called when an attribute of the meta data is modified.</p>

<p>If the modified attribute requires to reset a calculated attribute, the calculated attribute is reset (deleted from meta data structure) and the <i>initialized</i> flag is removed, too. The decision is made based on <code><code>%register_reset_on_modify</code></code>.</p>

</dd>
<dt id="register_reset_on_modify">register_reset_on_modify</dt>
<dd>

<p>Allows <code><code>set_table_meta_attr</code></code> to reset meta attributes when special attributes are modified. For DBD::File, modifying one of <code><code>f_file</code></code>, <code><code>f_dir</code></code>, <code><code>f_ext</code></code> or <code><code>f_lockfile</code></code> will reset <code><code>f_fqfn</code></code>. DBD::DBM extends the list for <code><code>dbm_type</code></code> and <code><code>dbm_mldbm</code></code> to reset the value of <code><code>dbm_tietype</code></code>.</p>

<p>If your DBD has calculated values in the meta data area, then call <code><code>register_reset_on_modify</code></code>:</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">%reset_on_modify</span> <span class="operator">=</span> <span class="operator">(</span> <span class="string">"xxx_foo"</span> <span class="operator">=&gt;</span> <span class="string">"xxx_bar"</span> <span class="operator">);</span>
    <span class="keyword">__PACKAGE__</span><span class="operator">-&gt;</span><span class="variable">register_reset_on_modify</span><span class="operator">(</span> <span class="operator">\</span><span class="variable">%reset_on_modify</span> <span class="operator">);</span>
</code></code></pre>

</dd>
<dt id="register_compat_map">register_compat_map</dt>
<dd>

<p>Allows <code><code>get_table_meta_attr</code></code> and <code><code>set_table_meta_attr</code></code> to update the attribute name to the current favored one:</p>

<pre><code><code>    <span class="comment"># from DBD::DBM</span>
    <span class="keyword">my</span> <span class="variable">%compat_map</span> <span class="operator">=</span> <span class="operator">(</span> <span class="string">"dbm_ext"</span> <span class="operator">=&gt;</span> <span class="string">"f_ext"</span> <span class="operator">);</span>
    <span class="keyword">__PACKAGE__</span><span class="operator">-&gt;</span><span class="variable">register_compat_map</span><span class="operator">(</span> <span class="operator">\</span><span class="variable">%compat_map</span> <span class="operator">);</span>
</code></code></pre>

</dd>
<dt id="open_data">open_data</dt>
<dd>

<p>Called to open the table&#39;s data storage. This is silently forwarded to <code><code><span class="variable">$meta</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sql_data_source</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="variable">open_data</span><span class="operator">()</span>
</code></code>.</p>

<p>After this is done, a derived class might add more steps in an overridden <code><code>open_file</code></code> method.</p>

</dd>
<dt id="new">new</dt>
<dd>

<p>Instantiates the table. This is done in 3 steps:</p>

<pre><code><code> 1. get the table meta data
 2. open the data file
 3. bless the table data structure using inherited constructor new</code></code></pre>

<p>It is not recommended to override the constructor of the table class. Find a reasonable place to add you extensions in one of the above four methods.</p>

</dd>
</dl>

<h1 id="AUTHOR">AUTHOR</h1>

<p>The module DBI::DBD::SqlEngine is currently maintained by</p>

<p>H.Merijn Brand &lt; h.m.brand at xs4all.nl &gt; and Jens Rehsack &lt; rehsack at googlemail.com &gt;</p>

<h1 id="COPYRIGHT-AND-LICENSE">COPYRIGHT AND LICENSE</h1>

<p>Copyright (C) 2010 by H.Merijn Brand &amp; Jens Rehsack</p>

<p>All rights reserved.</p>

<p>You may freely distribute and/or modify this module under the terms of either the GNU General Public License (GPL) or the Artistic License, as specified in the Perl README file.</p>


</body>

</html>


